<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사이냅소프트 채용퀴즈</title>    
    <link rel="stylesheet" type="text/css" href="./assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/styles.css">
    <!-- <link rel="stylesheet" type="text/css" href="./assets/css/code.css"> -->
</head>    
<body>
    <div class="container">
        <!-- <div class="header">
            <p>사이냅소프트 채용퀴즈</p>
        </div> -->
        <div class="content">
            <div class="code-container">                
                <div class="line-numbers"></div>
                <textarea id="codeArea" class="custom-textarea" placeholder="금액을 한줄씩 구분하여 입력하세요" spellcheck="false"></textarea>                

                <div id="button-run" class="button-run"></div>                                              
            </div>
            <div class="result-container">
                <div class="result-top"></div>
                <div class="result-down"></div>
            </div>            
        </div>
        <div class="footer">
            <p>Copyright © bug41 All rights reserved</p>
        </div>        
    </div>    

    <script src="./assets/js/num_kr.js"></script>
    <script>        
        const codeArea = document.getElementById("codeArea");
        const lineNumbers = document.querySelector(".line-numbers");
        const resultTop = document.querySelector(".result-top");
        const resultDown = document.querySelector(".result-down");

        //라인, textarea 스크롤 싱크 맞추기
        lineNumbers.addEventListener('scroll', function() {
            codeArea.scrollTop = lineNumbers.scrollTop;
        });

        codeArea.addEventListener('scroll', function() {
            lineNumbers.scrollTop = codeArea.scrollTop;
        });

        // 샘플 텍스트 내용
        const codeText = `1원
80,270원
111,111원
1,234,567,890원
100,000,000,000,000원`;

        // 텍스트 행 번호 함께 변환
        function addLineNumbers(text) {
            const lines = text.split('\n');
            var html = '<ul>';

            lines.map((line, index) => {
                const lineNumber = index + 1;
                var number = lineNumber < 10 ? `&nbsp;${lineNumber}` : `${lineNumber}`;
                html += '<li>'+number+'</li>';                 
            });

            html+= '</ul>';
            return html;            
        }

        //textarea 에 입력된 데이터 배열로 가공
        function addLineToArray(text){
            //console.log(text);
            const lines = text.split('\n');
            let lineArray = [];
            lines.map((line, index) => {

                //숫자만 추출
                const onlyNumber = line.replace(/[^0-9]/g, "");

                //원이 없을경우 알아서 추가
                if(line.slice(-1) != '원'){
                    line = line +'원';
                }

                //콤마 잘못 찍혔을경우 강제로 재정의
                if(line.slice(0, -1) != parseInt(onlyNumber).toLocaleString()){
                    console.log("다른경우 " + line.slice(0, -1) + ' ' +  onlyNumber.toLocaleString())
                    line = parseInt(onlyNumber).toLocaleString();
                }

                lineArray.push(line);
            });

            return lineArray;

        }

        codeArea.value = codeText;
        lineNumbers.innerHTML = addLineNumbers(codeText);        

        codeArea.addEventListener("keyup", function(event) {
            lineNumbers.innerHTML = addLineNumbers(codeArea.value);
        });
        
        
        var btn = document.getElementById("button-run");
        btn.addEventListener("click", function(){

            resultTop.innerHTML = '';
            
            const insertDataArray = addLineToArray(codeArea.value);

            insertDataArray.forEach(number => {
                //console.log(`${number}원: ${numberToKorean(number)}`);
                const p_tag = document.createElement('p');
                p_tag.textContent = numberToKorean(number);
                resultTop.append(p_tag);
            });

            //const koreanAmount = numberToKorean(insertDataArray);

            
        });
    </script>
    
    
</body>
</html>